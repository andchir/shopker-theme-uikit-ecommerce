<div id="carouselImageGallery" class="carousel slide mb-3" data-bs-ride="false" data-interval="false">

    {% if fileFields | length > 1 %}
        <ol class="carousel-indicators carousel-indicators-inverted">
            {% for fieldName in fileFields|keys %}
                <li data-bs-target="#carouselImageGallery" data-bs-slide-to="{{ loop.index0 }}"{% if fieldName == fieldBaseName %} class="active"{% endif %}></li>
            {% endfor %}
        </ol>
    {% endif %}

    <div class="carousel-inner border rounded-big">

        {% if fileFields | length > 0 %}
            {% for fieldName in fileFields|keys %}
                <div class="carousel-item{% if fieldName == fieldBaseName %} active{% endif %}">
                    {% if fileFields[fieldName] is not empty %}
                        <a data-bs-toggle="modal" data-bs-target="#imageModal" href="{{ imageUrl(fileFields[fieldName]) }}" target="_blank">
                            <img class="d-block w-100" src="{{ imageUrl(fileFields[fieldName]) | imagine_filter('thumb_medium') }}" alt="">
                        </a>
                    {% else %}
                        <img src="/img/nofoto.png" alt="" style="width: 100%;">
                    {% endif %}
                </div>
            {% endfor %}
        {% else %}
            <img src="/img/nofoto.png" alt="" style="width: 100%;">
        {% endif %}

    </div>

    {% if fileFields | length > 1 %}
        <button type="button" class="carousel-control-prev carousel-control-icon" data-bs-target="#carouselImageGallery" data-bs-slide="prev">
            <i class="icon-keyboard_arrow_left"></i>
        </button>
        <button type="button" class="carousel-control-next carousel-control-icon" data-bs-target="#carouselImageGallery" data-bs-slide="next">
            <i class="icon-keyboard_arrow_right"></i>
        </button>
    {% endif %}
</div>

<div class="modal fade" tabindex="-1" role="dialog" id="imageModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <img class="d-block w-100" src="" alt="">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{{ 'Close' | trans }}</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        jQuery('#imageModal')
            .on('show.bs.modal', function (e) {
                var $modal = jQuery('#imageModal'),
                    currentImageUrl = jQuery('#carouselImageGallery')
                        .find('.carousel-item.active a').attr('href');

                $modal
                    .find('.modal-dialog').css({maxWidth: '990px'})
                    .find('img').attr('src', currentImageUrl);
            });
    });
</script>
